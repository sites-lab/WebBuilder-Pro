<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebBuilder Pro ‚Äî Admin</title>
    <link rel="icon" href="https://img.icons8.com/fluency/96/000000/rocket.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- ‚ö° STEP 1: PASTE YOUR FIREBASE CONFIG HERE ‚ö° -->
    <!-- Get it from: https://console.firebase.google.com ‚Üí Your Project ‚Üí Project Settings ‚Üí Your apps ‚Üí Web app -->
    <script>
        const FIREBASE_CONFIG = {
            apiKey: "AIzaSyACtwAXFJGewPZyQmOlpdVm-uchVrYW_n0",
            authDomain: "webbuilder-pro.firebaseapp.com",
            projectId: "webbuilder-pro",
            storageBucket: "webbuilder-pro.firebasestorage.app",
            messagingSenderId: "4905721247",
            appId: "1:4905721247:web:386697a11ccf4cbbc0f1aa"
        };
    </script>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <style>
        :root {
            --blue: #3b82f6;
            --purple: #8b5cf6;
            --green: #10b981;
            --orange: #f59e0b;
            --red: #ef4444;
            --dark: #0f172a;
            --dark2: #1e293b;
            --mid: #64748b;
            --light: #f1f5f9;
            --border: #e2e8f0;
            --white: #ffffff;
            --grad: linear-gradient(135deg, #3b82f6, #8b5cf6);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: #f1f5f9; color: var(--dark2); min-height: 100vh; }

        /* LOGIN */
        #login-screen {
            position: fixed; inset: 0;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
            display: flex; align-items: center; justify-content: center; z-index: 9999;
        }

        .login-card {
            background: white; border-radius: 24px; padding: 44px 40px;
            width: 100%; max-width: 400px; box-shadow: 0 40px 80px rgba(0,0,0,0.4);
            animation: slideUp 0.4s cubic-bezier(0.4,0,0.2,1);
        }

        @keyframes slideUp { from { opacity:0; transform:translateY(20px); } to { opacity:1; transform:translateY(0); } }

        .login-logo { text-align:center; margin-bottom:30px; }
        .login-logo .icon { width:60px; height:60px; background:var(--grad); border-radius:16px; display:inline-flex; align-items:center; justify-content:center; font-size:1.6rem; color:white; margin-bottom:14px; }
        .login-logo h1 { font-size:1.4rem; font-weight:800; background:var(--grad); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; }
        .login-logo p { font-size:0.85rem; color:var(--mid); margin-top:4px; }

        .login-field { margin-bottom:16px; }
        .login-field label { display:block; font-size:0.8rem; font-weight:600; color:var(--dark2); margin-bottom:7px; text-transform:uppercase; letter-spacing:0.4px; }
        .login-field input { width:100%; padding:12px 16px; border:2px solid var(--border); border-radius:10px; font-family:'Inter',sans-serif; font-size:0.9rem; color:var(--dark2); transition:border-color 0.2s; outline:none; }
        .login-field input:focus { border-color:var(--blue); }

        .login-btn { width:100%; padding:13px; background:var(--grad); color:white; border:none; border-radius:10px; font-family:'Inter',sans-serif; font-size:0.95rem; font-weight:700; cursor:pointer; margin-top:8px; display:flex; align-items:center; justify-content:center; gap:8px; transition:all 0.2s; }
        .login-btn:hover { opacity:0.9; transform:translateY(-1px); }
        .login-btn:disabled { opacity:0.7; cursor:not-allowed; transform:none; }

        .login-error { background:#fee2e2; color:#7f1d1d; padding:10px 14px; border-radius:8px; font-size:0.85rem; margin-top:12px; display:none; }

        /* SETUP BANNER */
        #setup-banner { background:linear-gradient(135deg,#f59e0b,#ef4444); color:white; padding:14px 24px; display:none; align-items:center; gap:12px; font-size:0.875rem; font-weight:500; }
        #setup-banner a { color:white; font-weight:700; }
        #setup-banner.visible { display:flex; }
        #setup-banner code { background:rgba(0,0,0,0.2); padding:2px 6px; border-radius:4px; font-size:0.8rem; }

        /* APP */
        #app { display:none; min-height:100vh; }
        #app.visible { display:flex; }

        .sidebar { width:250px; flex-shrink:0; background:var(--dark); min-height:100vh; display:flex; flex-direction:column; position:sticky; top:0; height:100vh; overflow-y:auto; }
        .sidebar-logo { padding:24px 20px; border-bottom:1px solid rgba(255,255,255,0.08); }
        .sidebar-logo .brand { font-size:1.2rem; font-weight:800; background:var(--grad); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; display:flex; align-items:center; gap:8px; }
        .sidebar-logo .sub { font-size:0.72rem; color:#64748b; margin-top:3px; padding-left:22px; }
        .sidebar-nav { padding:16px 12px; flex:1; }
        .nav-label { font-size:0.65rem; font-weight:700; text-transform:uppercase; letter-spacing:1px; color:#475569; padding:8px 12px 6px; }
        .nav-item { display:flex; align-items:center; gap:11px; padding:10px 14px; border-radius:10px; color:#94a3b8; font-size:0.875rem; font-weight:500; cursor:pointer; transition:all 0.18s; margin-bottom:2px; text-decoration:none; border:none; background:none; width:100%; text-align:left; }
        .nav-item i { width:17px; text-align:center; font-size:0.875rem; }
        .nav-item:hover { background:rgba(255,255,255,0.06); color:#e2e8f0; }
        .nav-item.active { background:rgba(59,130,246,0.18); color:var(--blue); }
        .nav-badge { margin-left:auto; background:var(--red); color:white; font-size:0.7rem; font-weight:700; padding:2px 7px; border-radius:20px; }
        .sidebar-bottom { padding:14px 12px; border-top:1px solid rgba(255,255,255,0.06); }
        .admin-tag { display:flex; align-items:center; gap:10px; padding:10px 12px; }
        .admin-avatar { width:32px; height:32px; border-radius:50%; background:var(--grad); display:flex; align-items:center; justify-content:center; font-size:0.8rem; font-weight:700; color:white; flex-shrink:0; }
        .admin-info { flex:1; overflow:hidden; }
        .admin-name { font-size:0.8rem; font-weight:600; color:#e2e8f0; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
        .admin-role { font-size:0.7rem; color:#475569; }
        .logout-btn { width:30px; height:30px; border-radius:8px; border:none; background:rgba(255,255,255,0.06); color:#64748b; cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:0.8rem; transition:all 0.2s; flex-shrink:0; }
        .logout-btn:hover { background:rgba(239,68,68,0.2); color:var(--red); }

        .main { flex:1; display:flex; flex-direction:column; overflow:hidden; min-width:0; }

        .topbar { background:white; border-bottom:1px solid var(--border); padding:16px 28px; display:flex; align-items:center; justify-content:space-between; flex-shrink:0; }
        .topbar-left h2 { font-size:1.1rem; font-weight:800; }
        .topbar-left p { font-size:0.78rem; color:var(--mid); margin-top:1px; }
        .topbar-right { display:flex; align-items:center; gap:10px; }

        .btn { display:inline-flex; align-items:center; gap:7px; padding:8px 16px; border-radius:8px; font-family:'Inter',sans-serif; font-size:0.83rem; font-weight:600; cursor:pointer; border:none; transition:all 0.18s; }
        .btn-primary { background:var(--grad); color:white; }
        .btn-primary:hover { opacity:0.9; transform:translateY(-1px); }
        .btn-ghost { background:transparent; color:var(--mid); border:1px solid var(--border); }
        .btn-ghost:hover { background:var(--light); color:var(--dark2); }

        .page { display:none; padding:24px 28px; overflow-y:auto; flex:1; }
        .page.active { display:block; }

        /* STATS */
        .stats-row { display:grid; grid-template-columns:repeat(4,1fr); gap:16px; margin-bottom:24px; }
        .stat-card { background:white; border-radius:14px; padding:20px; border:1px solid var(--border); position:relative; overflow:hidden; }
        .stat-card::before { content:''; position:absolute; top:0; left:0; right:0; height:3px; }
        .stat-card.blue::before { background:var(--blue); }
        .stat-card.green::before { background:var(--green); }
        .stat-card.orange::before { background:var(--orange); }
        .stat-card.purple::before { background:var(--purple); }
        .stat-top { display:flex; align-items:flex-start; justify-content:space-between; margin-bottom:12px; }
        .stat-icon { width:40px; height:40px; border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:1rem; }
        .stat-icon.blue { background:#eff6ff; color:var(--blue); }
        .stat-icon.green { background:#ecfdf5; color:var(--green); }
        .stat-icon.orange { background:#fffbeb; color:var(--orange); }
        .stat-icon.purple { background:#f5f3ff; color:var(--purple); }
        .stat-value { font-size:1.8rem; font-weight:800; line-height:1; }
        .stat-label { font-size:0.78rem; color:var(--mid); font-weight:500; margin-top:5px; }

        /* FILTERS */
        .filters { background:white; border:1px solid var(--border); border-radius:12px; padding:14px 18px; display:flex; align-items:center; gap:10px; margin-bottom:18px; flex-wrap:wrap; }
        .search-wrap { display:flex; align-items:center; gap:8px; background:var(--light); border-radius:8px; padding:8px 14px; flex:1; min-width:220px; }
        .search-wrap i { color:var(--mid); font-size:0.85rem; }
        .search-wrap input { border:none; background:transparent; font-family:'Inter',sans-serif; font-size:0.875rem; color:var(--dark2); width:100%; outline:none; }
        .fselect { padding:8px 12px; border:1px solid var(--border); border-radius:8px; font-family:'Inter',sans-serif; font-size:0.83rem; color:var(--dark2); background:white; cursor:pointer; outline:none; }

        /* TABLE */
        .table-wrap { background:white; border:1px solid var(--border); border-radius:14px; overflow:hidden; }
        .table-head { padding:16px 22px; border-bottom:1px solid var(--border); display:flex; align-items:center; justify-content:space-between; }
        .table-head h3 { font-size:0.95rem; font-weight:700; }
        .table-count { font-size:0.78rem; color:var(--mid); }
        table { width:100%; border-collapse:collapse; }
        th { padding:11px 18px; text-align:left; font-size:0.72rem; font-weight:700; color:var(--mid); text-transform:uppercase; letter-spacing:0.5px; background:#f8fafc; border-bottom:1px solid var(--border); }
        td { padding:13px 18px; font-size:0.86rem; border-bottom:1px solid #f1f5f9; vertical-align:middle; }
        tr:last-child td { border-bottom:none; }
        tr:hover td { background:#fafbfc; }

        .oid { font-family:'Courier New',monospace; font-size:0.78rem; font-weight:700; color:var(--blue); background:#eff6ff; padding:3px 8px; border-radius:5px; white-space:nowrap; }
        .cust strong { display:block; font-weight:600; margin-bottom:2px; }
        .cust span { font-size:0.78rem; color:var(--mid); }
        .cust .phone { font-size:0.78rem; color:var(--mid); }

        .pkg { display:inline-flex; align-items:center; padding:3px 9px; border-radius:20px; font-size:0.76rem; font-weight:600; }
        .pkg-basic { background:#eff6ff; color:var(--blue); }
        .pkg-standard { background:#f5f3ff; color:var(--purple); }
        .pkg-premium { background:#fffbeb; color:var(--orange); }
        .pkg-ecommerce { background:#ecfdf5; color:var(--green); }

        .badge { display:inline-flex; align-items:center; gap:5px; padding:4px 10px; border-radius:20px; font-size:0.76rem; font-weight:600; }
        .badge::before { content:''; width:5px; height:5px; border-radius:50%; }
        .b-pending { background:#fffbeb; color:#92400e; } .b-pending::before { background:var(--orange); }
        .b-accepted { background:#ecfdf5; color:#065f46; } .b-accepted::before { background:var(--green); }
        .b-declined { background:#fee2e2; color:#7f1d1d; } .b-declined::before { background:var(--red); }
        .b-paid { background:#ecfdf5; color:#065f46; } .b-paid::before { background:var(--green); }
        .b-in_progress { background:#eff6ff; color:#1e40af; } .b-in_progress::before { background:var(--blue); }
        .b-completed { background:#f0fdf4; color:#14532d; } .b-completed::before { background:#22c55e; }

        .price { font-weight:700; }
        .dt { font-size:0.78rem; color:var(--mid); }
        .act { display:flex; align-items:center; gap:5px; }
        .ibtn { width:30px; height:30px; border-radius:7px; border:none; cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:0.78rem; transition:all 0.18s; }
        .ib-blue { background:#eff6ff; color:var(--blue); } .ib-blue:hover { background:#dbeafe; }
        .ib-green { background:#ecfdf5; color:var(--green); } .ib-green:hover { background:#d1fae5; }
        .ib-red { background:#fee2e2; color:var(--red); } .ib-red:hover { background:#fecaca; }

        .empty { padding:60px 20px; text-align:center; }
        .empty-ico { width:64px; height:64px; border-radius:50%; background:var(--light); display:flex; align-items:center; justify-content:center; margin:0 auto 14px; font-size:1.6rem; color:var(--mid); }
        .empty h3 { font-size:1rem; font-weight:700; margin-bottom:6px; }
        .empty p { color:var(--mid); font-size:0.875rem; }

        /* MODAL */
        .modal-bg { display:none; position:fixed; inset:0; background:rgba(15,23,42,0.55); backdrop-filter:blur(5px); z-index:500; align-items:center; justify-content:center; padding:20px; }
        .modal-bg.open { display:flex; }
        .modal { background:white; border-radius:20px; width:100%; max-width:600px; max-height:92vh; overflow-y:auto; animation:mIn 0.25s cubic-bezier(0.4,0,0.2,1); position:relative; }
        @keyframes mIn { from { opacity:0; transform:scale(0.96) translateY(8px); } to { opacity:1; transform:scale(1) translateY(0); } }
        .modal-hdr { padding:24px 26px 16px; display:flex; justify-content:space-between; align-items:flex-start; position:sticky; top:0; background:white; border-radius:20px 20px 0 0; border-bottom:1px solid var(--border); z-index:1; }
        .modal-hdr h3 { font-size:1.15rem; font-weight:800; }
        .modal-hdr p { font-size:0.78rem; color:var(--mid); margin-top:3px; }
        .close-modal { width:28px; height:28px; border-radius:7px; border:none; background:var(--light); cursor:pointer; display:flex; align-items:center; justify-content:center; color:var(--mid); font-size:0.85rem; transition:all 0.18s; }
        .close-modal:hover { background:#e2e8f0; }
        .modal-body { padding:22px 26px; }
        .sec { margin-bottom:22px; }
        .sec-title { font-size:0.7rem; font-weight:700; text-transform:uppercase; letter-spacing:0.5px; color:var(--mid); margin-bottom:10px; padding-bottom:6px; border-bottom:1px solid var(--border); }
        .drow { display:flex; justify-content:space-between; align-items:flex-start; padding:6px 0; font-size:0.865rem; gap:16px; }
        .drow .lbl { color:var(--mid); flex-shrink:0; }
        .drow .val { font-weight:600; text-align:right; word-break:break-word; }
        .notes-box { background:var(--light); border-radius:10px; padding:12px 14px; font-size:0.86rem; line-height:1.6; color:var(--dark2); font-style:italic; }

        .status-big { display:flex; gap:8px; flex-wrap:wrap; margin-top:8px; }
        .s-btn { flex:1; min-width:110px; padding:10px 12px; border-radius:10px; border:2px solid var(--border); font-family:'Inter',sans-serif; font-size:0.83rem; font-weight:600; cursor:pointer; transition:all 0.18s; background:white; color:var(--mid); display:flex; align-items:center; justify-content:center; gap:7px; }
        .s-btn:hover { transform:translateY(-1px); }
        .s-btn.accept { border-color:var(--green); color:var(--green); }
        .s-btn.accept:hover, .s-btn.accept.sel { background:var(--green); color:white; }
        .s-btn.decline { border-color:var(--red); color:var(--red); }
        .s-btn.decline:hover, .s-btn.decline.sel { background:var(--red); color:white; }
        .s-btn.inprog { border-color:var(--blue); color:var(--blue); }
        .s-btn.inprog:hover, .s-btn.inprog.sel { background:var(--blue); color:white; }
        .s-btn.done { border-color:var(--purple); color:var(--purple); }
        .s-btn.done:hover, .s-btn.done.sel { background:var(--purple); color:white; }

        .save-status-btn { width:100%; padding:12px; background:var(--grad); color:white; border:none; border-radius:10px; font-family:'Inter',sans-serif; font-size:0.9rem; font-weight:700; cursor:pointer; margin-top:14px; display:flex; align-items:center; justify-content:center; gap:8px; transition:all 0.2s; }
        .save-status-btn:hover { opacity:0.9; transform:translateY(-1px); }
        .save-status-btn:disabled { opacity:0.6; cursor:not-allowed; transform:none; }

        /* TOAST */
        .toast { position:fixed; bottom:22px; right:22px; background:var(--dark); color:white; padding:12px 18px; border-radius:10px; font-size:0.86rem; font-weight:500; display:flex; align-items:center; gap:9px; z-index:9999; transform:translateY(70px); opacity:0; transition:all 0.3s cubic-bezier(0.4,0,0.2,1); max-width:320px; }
        .toast.show { transform:translateY(0); opacity:1; }
        .toast.success i { color:var(--green); }
        .toast.error i { color:var(--red); }

        .loading-row td { padding:40px; text-align:center; color:var(--mid); font-size:0.875rem; }

        @media (max-width:1000px) { .stats-row { grid-template-columns:repeat(2,1fr); } }
        @media (max-width:768px) { .sidebar { display:none; } .stats-row { grid-template-columns:1fr 1fr; } .page { padding:16px; } .topbar { padding:14px 16px; } }
        @media (max-width:500px) { .stats-row { grid-template-columns:1fr; } }
    </style>
</head>
<body>

<!-- LOGIN -->
<div id="login-screen">
    <div class="login-card">
        <div class="login-logo">
            <div class="icon"><i class="fas fa-rocket"></i></div>
            <h1>WebBuilder Pro</h1>
            <p>Admin Dashboard ‚Äî Sign in to continue</p>
        </div>
        <div class="login-field">
            <label>Email</label>
            <input type="email" id="login-email" placeholder="admin@youremail.com" autocomplete="email">
        </div>
        <div class="login-field">
            <label>Password</label>
            <input type="password" id="login-pass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password">
        </div>
        <button class="login-btn" id="login-btn" onclick="doLogin()">
            <i class="fas fa-sign-in-alt"></i> Sign In
        </button>
        <div class="login-error" id="login-err"></div>
    </div>
</div>

<!-- SETUP BANNER -->
<div id="setup-banner">
    <i class="fas fa-exclamation-triangle"></i>
    <span>‚ö° <strong>Demo Mode</strong> ‚Äî Firebase not configured yet. Open <code>admin.html</code> in a text editor and replace the <code>FIREBASE_CONFIG</code> values. See <code>SETUP_GUIDE.txt</code> for instructions. <a href="https://console.firebase.google.com" target="_blank">Firebase Console ‚Üí</a></span>
</div>

<!-- APP -->
<div id="app">
    <aside class="sidebar">
        <div class="sidebar-logo">
            <div class="brand"><i class="fas fa-rocket"></i> WebBuilder Pro</div>
            <div class="sub">Admin Panel</div>
        </div>
        <nav class="sidebar-nav">
            <div class="nav-label">Management</div>
            <button class="nav-item active" id="nav-orders">
                <i class="fas fa-shopping-bag"></i> Orders
                <span class="nav-badge" id="pending-badge" style="display:none">0</span>
            </button>
            <div class="nav-label" style="margin-top:8px">Site</div>
            <a class="nav-item" href="index.html" target="_blank"><i class="fas fa-globe"></i> View Website</a>
            <a class="nav-item" href="payment.html" target="_blank"><i class="fas fa-credit-card"></i> Payment Page</a>
        </nav>
        <div class="sidebar-bottom">
            <div class="admin-tag">
                <div class="admin-avatar" id="admin-avatar">A</div>
                <div class="admin-info">
                    <div class="admin-name" id="admin-email-display">admin</div>
                    <div class="admin-role">Administrator</div>
                </div>
                <button class="logout-btn" title="Sign out" onclick="doLogout()"><i class="fas fa-sign-out-alt"></i></button>
            </div>
        </div>
    </aside>

    <div class="main">
        <div class="topbar">
            <div class="topbar-left">
                <h2>Orders</h2>
                <p>All customer orders ‚Äî updates in real-time</p>
            </div>
            <div class="topbar-right">
                <button class="btn btn-ghost" onclick="exportCSV()"><i class="fas fa-download"></i> Export CSV</button>
                <button class="btn btn-ghost" onclick="refreshOrders()"><i class="fas fa-sync-alt"></i> Refresh</button>
            </div>
        </div>

        <div class="page active" id="page-orders">
            <div class="stats-row">
                <div class="stat-card blue">
                    <div class="stat-top">
                        <div><div class="stat-value" id="s-total">0</div><div class="stat-label">Total Orders</div></div>
                        <div class="stat-icon blue"><i class="fas fa-inbox"></i></div>
                    </div>
                </div>
                <div class="stat-card orange">
                    <div class="stat-top">
                        <div><div class="stat-value" id="s-pending">0</div><div class="stat-label">Pending Review</div></div>
                        <div class="stat-icon orange"><i class="fas fa-clock"></i></div>
                    </div>
                </div>
                <div class="stat-card green">
                    <div class="stat-top">
                        <div><div class="stat-value" id="s-accepted">0</div><div class="stat-label">Accepted</div></div>
                        <div class="stat-icon green"><i class="fas fa-check-circle"></i></div>
                    </div>
                </div>
                <div class="stat-card purple">
                    <div class="stat-top">
                        <div><div class="stat-value" id="s-revenue">‚Ç¨0</div><div class="stat-label">Total Value</div></div>
                        <div class="stat-icon purple"><i class="fas fa-euro-sign"></i></div>
                    </div>
                </div>
            </div>

            <div class="filters">
                <div class="search-wrap">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchInput" placeholder="Search by name, email, phone, order ID..." oninput="applyFilters()">
                </div>
                <select class="fselect" id="fStatus" onchange="applyFilters()">
                    <option value="">All Statuses</option>
                    <option value="pending">‚è≥ Pending</option>
                    <option value="accepted">‚úÖ Accepted</option>
                    <option value="declined">‚ùå Declined</option>
                    <option value="in_progress">üîß In Progress</option>
                    <option value="completed">üéâ Completed</option>
                    <option value="paid">üí∞ Paid</option>
                </select>
                <select class="fselect" id="fPkg" onchange="applyFilters()">
                    <option value="">All Packages</option>
                    <option value="basic">Basic (‚Ç¨80)</option>
                    <option value="standard">Standard (‚Ç¨300)</option>
                    <option value="premium">Premium (‚Ç¨550)</option>
                    <option value="ecommerce">E-Commerce</option>
                </select>
            </div>

            <div class="table-wrap">
                <div class="table-head">
                    <h3>Customer Orders</h3>
                    <span class="table-count" id="table-count">Loading...</span>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Order ID</th>
                            <th>Customer</th>
                            <th>Package</th>
                            <th>Total</th>
                            <th>Status</th>
                            <th>Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="tbody">
                        <tr class="loading-row"><td colspan="7"><i class="fas fa-circle-notch fa-spin"></i> Loading orders...</td></tr>
                    </tbody>
                </table>
                <div class="empty" id="empty-state" style="display:none">
                    <div class="empty-ico"><i class="fas fa-inbox"></i></div>
                    <h3>No orders yet</h3>
                    <p>Orders from the website will appear here in real-time.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- MODAL -->
<div class="modal-bg" id="modal">
    <div class="modal">
        <div class="modal-hdr">
            <div>
                <h3 id="m-title">Order Details</h3>
                <p id="m-subtitle"></p>
            </div>
            <button class="close-modal" onclick="closeModal()"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body">
            <div class="sec">
                <div class="sec-title"><i class="fas fa-user"></i> Customer Information</div>
                <div class="drow"><span class="lbl">Full Name</span><span class="val" id="m-name">‚Äî</span></div>
                <div class="drow"><span class="lbl">Email</span><span class="val" id="m-email">‚Äî</span></div>
                <div class="drow"><span class="lbl">Phone</span><span class="val" id="m-phone">‚Äî</span></div>
            </div>
            <div class="sec">
                <div class="sec-title"><i class="fas fa-box"></i> Order Details</div>
                <div class="drow"><span class="lbl">Order ID</span><span class="val" id="m-oid">‚Äî</span></div>
                <div class="drow"><span class="lbl">Package</span><span class="val" id="m-pkg">‚Äî</span></div>
                <div class="drow"><span class="lbl">Base Price</span><span class="val" id="m-base">‚Äî</span></div>
                <div class="drow"><span class="lbl">Add-ons</span><span class="val" id="m-addons">‚Äî</span></div>
                <div class="drow"><span class="lbl">Maintenance</span><span class="val" id="m-maint">‚Äî</span></div>
                <div class="drow" style="border-top:2px solid var(--border);margin-top:6px;padding-top:10px">
                    <span class="lbl">Total Price</span>
                    <span class="val" id="m-total" style="font-size:1.1rem;color:var(--blue)">‚Äî</span>
                </div>
            </div>
            <div class="sec" id="m-notes-sec" style="display:none">
                <div class="sec-title"><i class="fas fa-comment"></i> Customer Notes</div>
                <div class="notes-box" id="m-notes"></div>
            </div>
            <div class="sec">
                <div class="sec-title"><i class="fas fa-credit-card"></i> Payment</div>
                <div class="drow"><span class="lbl">Payment Method</span><span class="val" id="m-pmeth">‚Äî</span></div>
                <div class="drow"><span class="lbl">Payment Status</span><span class="val" id="m-pstatus">‚Äî</span></div>
                <div class="drow"><span class="lbl">Amount Paid</span><span class="val" id="m-paid">‚Äî</span></div>
                <div class="drow"><span class="lbl">Payment Date</span><span class="val" id="m-pdate">‚Äî</span></div>
            </div>
            <div class="sec">
                <div class="sec-title"><i class="fas fa-edit"></i> Update Order Status</div>
                <div class="status-big">
                    <button class="s-btn accept" onclick="setModalStatus('accepted')"><i class="fas fa-check"></i> Accept</button>
                    <button class="s-btn decline" onclick="setModalStatus('declined')"><i class="fas fa-times"></i> Decline</button>
                    <button class="s-btn inprog" onclick="setModalStatus('in_progress')"><i class="fas fa-cog"></i> In Progress</button>
                    <button class="s-btn done" onclick="setModalStatus('completed')"><i class="fas fa-flag-checkered"></i> Completed</button>
                </div>
                <button class="save-status-btn" id="save-status-btn" onclick="saveStatus()">
                    <i class="fas fa-save"></i> Save Status
                </button>
            </div>
        </div>
    </div>
</div>

<div class="toast" id="toast"><i class="fas fa-check-circle"></i><span id="toast-msg">Done</span></div>

<script>
let db = null, auth = null;
let allOrders = [], filteredOrders = [];
let currentOrderId = null, selectedStatus = null, unsubscribe = null;

function initFirebase() {
    try {
        if (FIREBASE_CONFIG.apiKey === 'YOUR_API_KEY') {
            document.getElementById('setup-banner').classList.add('visible');
            enableDemoMode();
            return;
        }
        firebase.initializeApp(FIREBASE_CONFIG);
        db = firebase.firestore();
        auth = firebase.auth();
        auth.onAuthStateChanged(user => {
            if (user) {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('app').classList.add('visible');
                document.getElementById('admin-email-display').textContent = user.email || '';
                document.getElementById('admin-avatar').textContent = (user.email || 'A').charAt(0).toUpperCase();
                startListening();
            } else {
                document.getElementById('login-screen').style.display = 'flex';
                document.getElementById('app').classList.remove('visible');
            }
        });
    } catch(e) {
        console.error('Firebase init error:', e);
        document.getElementById('setup-banner').classList.add('visible');
        enableDemoMode();
    }
}

async function doLogin() {
    const email = document.getElementById('login-email').value.trim();
    const pass = document.getElementById('login-pass').value;
    const btn = document.getElementById('login-btn');
    if (!email || !pass) { showLoginError('Please enter email and password.'); return; }
    btn.disabled = true;
    btn.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> Signing in...';
    document.getElementById('login-err').style.display = 'none';
    try {
        await auth.signInWithEmailAndPassword(email, pass);
    } catch(e) {
        const msgs = { 'auth/user-not-found':'No account found with this email.', 'auth/wrong-password':'Incorrect password.', 'auth/too-many-requests':'Too many attempts. Try again later.', 'auth/invalid-email':'Invalid email address.', 'auth/invalid-credential':'Invalid email or password.' };
        showLoginError(msgs[e.code] || 'Sign in failed: ' + e.message);
        btn.disabled = false;
        btn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Sign In';
    }
}

function showLoginError(msg) { const el = document.getElementById('login-err'); el.textContent = msg; el.style.display = 'block'; }

async function doLogout() { if (unsubscribe) unsubscribe(); if (auth) await auth.signOut(); }

document.addEventListener('DOMContentLoaded', () => {
    ['login-email','login-pass'].forEach(id => {
        document.getElementById(id)?.addEventListener('keydown', e => { if (e.key==='Enter') doLogin(); });
    });
    document.getElementById('modal').addEventListener('click', e => { if(e.target===document.getElementById('modal')) closeModal(); });
});

function startListening() {
    if (!db) return;
    if (unsubscribe) unsubscribe();
    unsubscribe = db.collection('orders').orderBy('timestamp','desc').onSnapshot(snap => {
        allOrders = snap.docs.map(d => ({ _id: d.id, ...d.data() }));
        applyFilters(); updateStats(); updateBadge();
    }, err => { toast('Error: ' + err.message, true); });
}

function refreshOrders() { startListening(); toast('Refreshed!'); }

function updateStats() {
    const t = allOrders.length;
    const p = allOrders.filter(o => !o.status || o.status==='pending').length;
    const a = allOrders.filter(o => ['accepted','in_progress','completed','paid'].includes(o.status)).length;
    const r = allOrders.reduce((s,o) => s+parseInt(o.total_price||o.package_price||0), 0);
    document.getElementById('s-total').textContent = t;
    document.getElementById('s-pending').textContent = p;
    document.getElementById('s-accepted').textContent = a;
    document.getElementById('s-revenue').textContent = '‚Ç¨'+r;
}

function updateBadge() {
    const p = allOrders.filter(o => !o.status || o.status==='pending').length;
    const b = document.getElementById('pending-badge');
    b.textContent = p; b.style.display = p>0 ? 'inline' : 'none';
}

function applyFilters() {
    const q = (document.getElementById('searchInput')?.value||'').toLowerCase();
    const sf = document.getElementById('fStatus')?.value||'';
    const pf = document.getElementById('fPkg')?.value||'';
    filteredOrders = allOrders.filter(o => {
        const ms = !q || (o.customer_name||'').toLowerCase().includes(q) || (o.customer_email||'').toLowerCase().includes(q) || (o.customer_phone||'').toLowerCase().includes(q) || (o.order_id||'').toLowerCase().includes(q);
        const mst = !sf || (o.status||'pending')===sf;
        const mpk = !pf || (o.service_type||'').includes(pf);
        return ms && mst && mpk;
    });
    renderTable();
}

function renderTable() {
    const tbody = document.getElementById('tbody');
    const empty = document.getElementById('empty-state');
    document.getElementById('table-count').textContent = filteredOrders.length + ' order' + (filteredOrders.length!==1?'s':'');
    if (filteredOrders.length===0) { tbody.innerHTML=''; empty.style.display='block'; return; }
    empty.style.display='none';
    const labels = { pending:'‚è≥ Pending', accepted:'‚úÖ Accepted', declined:'‚ùå Declined', in_progress:'üîß In Progress', completed:'üéâ Completed', paid:'üí∞ Paid' };
    tbody.innerHTML = filteredOrders.map(o => {
        const s = o.status||'pending';
        return `<tr>
            <td><span class="oid">${esc(o.order_id||o._id?.slice(0,10)||'‚Äî')}</span></td>
            <td><div class="cust"><strong>${esc(o.customer_name||'‚Äî')}</strong><span>${esc(o.customer_email||'‚Äî')}</span><div class="phone">${esc(o.customer_phone||'')}</div></div></td>
            <td><span class="pkg ${pkgCls(o.service_type)}">${pkgLabel(o.service_type)}</span></td>
            <td class="price">‚Ç¨${o.total_price||o.package_price||'0'}</td>
            <td><span class="badge b-${s}">${labels[s]||s}</span></td>
            <td class="dt">${fmtDate(o.timestamp)}</td>
            <td><div class="act">
                <button class="ibtn ib-blue" title="View Details" onclick="openModal('${o._id}')"><i class="fas fa-eye"></i></button>
                <button class="ibtn ib-green" title="Accept" onclick="quickUpdate('${o._id}','accepted')"><i class="fas fa-check"></i></button>
                <button class="ibtn ib-red" title="Decline" onclick="quickUpdate('${o._id}','declined')"><i class="fas fa-times"></i></button>
            </div></td>
        </tr>`;
    }).join('');
}

function openModal(docId) {
    const o = allOrders.find(x => x._id===docId);
    if (!o) return;
    currentOrderId = docId;
    selectedStatus = o.status||'pending';
    document.getElementById('m-title').textContent = 'Order '+(o.order_id||docId.slice(0,12));
    document.getElementById('m-subtitle').textContent = fmtDate(o.timestamp, true);
    document.getElementById('m-name').textContent = o.customer_name||'‚Äî';
    document.getElementById('m-email').textContent = o.customer_email||'‚Äî';
    document.getElementById('m-phone').textContent = o.customer_phone||'‚Äî';
    document.getElementById('m-oid').textContent = o.order_id||'‚Äî';
    document.getElementById('m-pkg').textContent = pkgLabel(o.service_type);
    document.getElementById('m-base').textContent = '‚Ç¨'+(o.package_price||'0');
    let ao = '‚Äî';
    if (o.add_ons?.length) ao = o.add_ons.map(a => (a.name||a)+' (+‚Ç¨'+(a.price||'?')+')').join(', ');
    document.getElementById('m-addons').textContent = ao;
    document.getElementById('m-maint').textContent = o.maintenance_plan||'‚Äî';
    document.getElementById('m-total').textContent = '‚Ç¨'+(o.total_price||o.package_price||'0');
    if (o.additional_notes) { document.getElementById('m-notes-sec').style.display='block'; document.getElementById('m-notes').textContent=o.additional_notes; }
    else { document.getElementById('m-notes-sec').style.display='none'; }
    document.getElementById('m-pmeth').textContent = o.payment_method||'‚Äî';
    document.getElementById('m-pstatus').textContent = o.payment_status||'‚Äî';
    document.getElementById('m-paid').textContent = o.paid_amount ? '‚Ç¨'+o.paid_amount : '‚Äî';
    document.getElementById('m-pdate').textContent = o.payment_date ? fmtDate(o.payment_date,true) : '‚Äî';
    updateStatusButtons(selectedStatus);
    document.getElementById('modal').classList.add('open');
}

function setModalStatus(s) { selectedStatus=s; updateStatusButtons(s); }

function updateStatusButtons(cur) {
    document.querySelectorAll('.s-btn').forEach(b => b.classList.remove('sel'));
    const m = { accepted:'accept', declined:'decline', in_progress:'inprog', completed:'done' };
    if (m[cur]) document.querySelector('.s-btn.'+m[cur])?.classList.add('sel');
}

async function saveStatus() {
    if (!currentOrderId || !selectedStatus) return;
    const btn = document.getElementById('save-status-btn');
    btn.disabled = true; btn.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> Saving...';
    try {
        if (db) await db.collection('orders').doc(currentOrderId).update({ status: selectedStatus, status_updated: new Date().toISOString() });
        else { const i=allOrders.findIndex(o=>o._id===currentOrderId); if(i!==-1) allOrders[i].status=selectedStatus; }
        toast('Status updated to "'+selectedStatus+'"!'); closeModal();
    } catch(e) { toast('Error: '+e.message, true); }
    finally { btn.disabled=false; btn.innerHTML='<i class="fas fa-save"></i> Save Status'; }
}

async function quickUpdate(docId, status) {
    try {
        if (db) await db.collection('orders').doc(docId).update({ status, status_updated: new Date().toISOString() });
        else { const i=allOrders.findIndex(o=>o._id===docId); if(i!==-1){allOrders[i].status=status; applyFilters(); updateStats(); updateBadge();} }
        toast('Marked as '+status+'!');
    } catch(e) { toast('Error: '+e.message, true); }
}

function closeModal() { document.getElementById('modal').classList.remove('open'); currentOrderId=null; selectedStatus=null; }

function exportCSV() {
    if (allOrders.length===0) { toast('No orders to export', true); return; }
    const h = ['Order ID','Name','Email','Phone','Package','Base Price','Add-ons','Maintenance','Total','Status','Notes','Payment Method','Payment Status','Paid Amount','Date'];
    const rows = allOrders.map(o => [
        o.order_id||'', o.customer_name||'', o.customer_email||'', o.customer_phone||'',
        pkgLabel(o.service_type), o.package_price||'0',
        o.add_ons?.length ? o.add_ons.map(a=>a.name||a).join('; ') : '',
        o.maintenance_plan||'', o.total_price||o.package_price||'0', o.status||'pending',
        o.additional_notes||'', o.payment_method||'', o.payment_status||'', o.paid_amount||'',
        fmtDate(o.timestamp,true)
    ].map(v=>'"'+String(v).replace(/"/g,'""')+'"').join(','));
    const csv = [h.join(','),...rows].join('\n');
    const blob = new Blob([csv],{type:'text/csv;charset=utf-8;'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href=url; a.download='orders_'+new Date().toISOString().slice(0,10)+'.csv'; a.click();
    URL.revokeObjectURL(url); toast('Exported '+allOrders.length+' orders!');
}

// DEMO MODE
function enableDemoMode() {
    document.getElementById('login-btn').onclick = () => {
        const e = document.getElementById('login-email').value;
        const p = document.getElementById('login-pass').value;
        if (!e || !p) { showLoginError('Enter any email and password to try demo.'); return; }
        document.getElementById('login-screen').style.display='none';
        document.getElementById('app').classList.add('visible');
        document.getElementById('admin-email-display').textContent = e;
        document.getElementById('admin-avatar').textContent = e.charAt(0).toUpperCase();
        allOrders = [
            { _id:'d1', order_id:'WB-1748293847', customer_name:'Ion Popescu', customer_email:'ion@example.com', customer_phone:'+40 729 000 111', service_type:'standard', package_price:300, add_ons:[{name:'Basic Hosting',price:4}], maintenance_plan:'simple_maintenance', total_price:324, status:'pending', additional_notes:'I need the site in Romanian and English. Can you add Google Maps?', timestamp:new Date(Date.now()-3600000).toISOString() },
            { _id:'d2', order_id:'WB-1748291234', customer_name:'Maria Ionescu', customer_email:'maria@coffeeshop.ro', customer_phone:'+40 754 321 987', service_type:'basic', package_price:80, add_ons:[], maintenance_plan:'', total_price:80, status:'accepted', additional_notes:'', timestamp:new Date(Date.now()-86400000).toISOString() },
            { _id:'d3', order_id:'WB-1748287654', customer_name:'Alexandru Duma', customer_email:'alex@store.ro', customer_phone:'+40 766 456 789', service_type:'premium', package_price:550, add_ons:[{name:'.ro Domain',price:8},{name:'Basic Hosting',price:4}], maintenance_plan:'standard_maintenance', total_price:597, status:'in_progress', payment_method:'paypal', payment_status:'completed', paid_amount:120, additional_notes:'Please add online booking system for the restaurant.', timestamp:new Date(Date.now()-172800000).toISOString() },
            { _id:'d4', order_id:'WB-1748280000', customer_name:'Elena Gheorghe', customer_email:'elena@salonspa.ro', customer_phone:'+40 788 123 456', service_type:'standard', package_price:300, add_ons:[{name:'.eu Domain',price:5}], maintenance_plan:'', total_price:305, status:'declined', additional_notes:'Need a portfolio site for my beauty salon.', timestamp:new Date(Date.now()-259200000).toISOString() },
        ];
        applyFilters(); updateStats(); updateBadge();
    };
}

// HELPERS
function pkgLabel(t) { const m={basic:'Basic',standard:'Standard',premium:'Premium',ecommerce:'E-Commerce','basic-website':'Basic','standard-website':'Standard','premium-website':'Premium','ecommerce-website':'E-Commerce'}; return m[t]||(t?t.charAt(0).toUpperCase()+t.slice(1):'‚Äî'); }
function pkgCls(t) { if(!t) return 'pkg-basic'; if(t.includes('basic')) return 'pkg-basic'; if(t.includes('standard')) return 'pkg-standard'; if(t.includes('premium')) return 'pkg-premium'; if(t.includes('ecommerce')) return 'pkg-ecommerce'; return 'pkg-basic'; }
function fmtDate(v, full=false) {
    if (!v) return '‚Äî';
    let d = v?.toDate ? v.toDate() : new Date(v);
    if (isNaN(d)) return '‚Äî';
    if (full) return d.toLocaleDateString('en-GB',{day:'2-digit',month:'short',year:'numeric'})+' '+d.toLocaleTimeString('en-GB',{hour:'2-digit',minute:'2-digit'});
    return d.toLocaleDateString('en-GB',{day:'2-digit',month:'short',year:'numeric'});
}
function esc(s) { return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }
function toast(msg, isErr=false) {
    const t=document.getElementById('toast');
    t.querySelector('i').className='fas '+(isErr?'fa-exclamation-circle':'fa-check-circle');
    t.className='toast '+(isErr?'error':'success');
    document.getElementById('toast-msg').textContent=msg;
    t.classList.add('show');
    setTimeout(()=>t.classList.remove('show'),3000);
}

initFirebase();
</script>
</body>
</html>
